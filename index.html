<!DOCTYPE html>
<html>
	<head>
		<link rel="stylesheet" href = "style.css">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<script>
        function serialized_display() {
             res = 
                fetch("songlist.json")
                .then (res => res.text())
                .then (data => 
                {
                    data = JSON.parse(data)
                    document.getElementById("serialized").innerHTML = JSON.stringify(data);
                })
                .catch (error => console.log(error))
        }
        
        function friendly_display() {
             res = 
                fetch("songlist.json")
                .then (res => res.text())
                .then (data => 
                {
                    data = JSON.parse(data)
                    display_filtered(data);
                })
                .catch (error => console.log(error))
        }
       
        function display_filtered(data) {
        	str = "";
          	data.forEach(elem => str += display_single(elem) + "<br>")
		document.getElementById("friendly").innerHTML = str;
        }



        // Intializes the dropdown menu
        // Instead of choosing to hardcode the genres, I thought this would
        // make the code more versatile in case we add more songs
	function initialize_form () {
        alert(total_genres);
		res = 
		fetch("songlist.json")
		.then (res => res.text())
		.then (data => 
		{
            data = JSON.parse(data)
            initialize_genres(data);
		})
		.catch (error => console.log(error))
    }
    


    total_genres = [];
	selection = "";
    function initialize_genres (data) {
        data.forEach(
			 song => song.genre.forEach(
                            genre => {
                            if (!total_genres.includes(genre))
                                total_genres.push(JSON.stringify(genre));
                            })
        )
        total_genres.forEach(
            genre => {selection += 
                "<option value=" + genre + ">" + genre + "</option>"}
        )
        alert(selection);
	    alert(total_genres);
        document.getElementById("select").innerHTML = selection;
    }


    function filter() {
		res = 
		fetch("songlist.json")
		.then (res => res.text())
		.then (data => 
		{
            data = JSON.parse(data)
            display_filtered(data);
		})
		.catch (error => console.log(error))
    }

        function display_filtered (data) {
            select = document.getElementById('select');
            value = select.options[select.selectedIndex].text;
            string = [];
            data.forEach(
                song => {
                    if (song.genre.includes(value)){
                        string += display_single(song);
                    }
                }
            )
            document.getElementById("friendly").innerHTML = string;
            document.getElementById("friendly_title").innerHTML = 
                "Filtered friendly display:";
        }

        function display_single (data) {
            return JSON.stringify(data.title) + "<br>"
                    + "Artist: " + JSON.stringify(data.artist) + "<br>"
                    + "Genre: " + JSON.stringify(data.genre) + "<br>"
                    + "Released " + JSON.stringify(data.year) + "<br>";
        }

        initialize_form();
        serialized_display();
        friendly_display();
    
	</script>
    </head>

    <body>
        <div class = "main_box">
            <h1> Apply filter:  
            <br>
            </h1>
            <label for="select">Choose a genre:</label>
            <select name="select" id="select"></select>
            <button onclick="filter()">Filter</button>
            <h1> Serialized format: <br> </h1>
            <p id = "serialized"></p>
            <h1 id = "friendly_title"> User friendly format: <br> </h1>
            <p id = "friendly"></p>
        </div>
    </body>
</html>
